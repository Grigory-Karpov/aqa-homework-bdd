name: Final CI Solution

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: maven

      - name: Download SUT, Run and Test
        run: |
          echo "--- 1. Downloading JAR from official Netology repo ---"
          # Используем ссылку на bdd/app-ibank-build-for-testers.jar из ветки master
          wget -O app-ibank.jar https://github.com/netology-code/aqa-homeworks/raw/master/bdd/app-ibank-build-for-testers.jar

          echo "--- 2. Checking file size (should not be empty) ---"
          ls -lh app-ibank.jar

          echo "--- 3. Starting application ---"
          java -jar app-ibank.jar &

          echo "--- 4. Waiting for launch (30 seconds) ---"
          sleep 30

          echo "--- 5. Checking port 9999 ---"
          netstat -tuln | grep 9999 || echo "WARNING: Port 9999 not found yet"

          echo "--- 6. Running Tests ---"
          mvn test